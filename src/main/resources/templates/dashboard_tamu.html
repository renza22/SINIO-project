<!doctype html>
<html lang="id" data-bs-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard Tamu - Hotel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    :root{
      --tosca-50:#ecfdfb; --tosca-100:#cffaf4; --tosca-200:#a5f2e6;
      --tosca-300:#73e5d3; --tosca-400:#3fd2bd; --tosca-500:#18b7a6; --tosca-600:#119a8d; --tosca-700:#0e7b71; --tosca-800:#0d625b; --tosca-900:#0b4e49;
      --glass-bg: rgba(255,255,255,.18); --glass-stroke: rgba(255,255,255,.4); --glass-shadow: 0 6px 28px rgba(0,0,0,.18); --ring: rgba(24,183,166,.35);
    }
    body{
      background:
        radial-gradient(1200px 800px at 10% -10%, rgba(24,183,166,.22), transparent 55%),
        radial-gradient(900px 600px at 120% 30%, rgba(63,210,189,.20), transparent 55%),
        linear-gradient(180deg, #f7fffe 0%, #f9fffd 60%, #f7fffe 100%);
      min-height:100dvh;
      color:#0b4e49;
    }
    .glass{ backdrop-filter: blur(14px) saturate(120%); -webkit-backdrop-filter: blur(14px) saturate(120%); background: var(--glass-bg); border: 1px solid var(--glass-stroke); box-shadow: var(--glass-shadow); border-radius: 1rem; }
    .shadow-glass{ box-shadow: var(--glass-shadow) !important; }

    .navbar-glass{ backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); background: rgba(255,255,255,.55) !important; border-bottom: 1px solid var(--glass-stroke); }
    .navbar-brand{ color: var(--tosca-700); font-weight:700; }
    .navbar-glass .nav-link{ color:#27323a }
    .navbar-glass .nav-link:hover,.navbar-glass .nav-link:focus{ color: var(--tosca-700) }

    .offcanvas-glass{ backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); background: rgba(255,255,255,.65); border-left: 1px solid var(--glass-stroke); }

    .btn-tosca{ --bs-btn-bg: var(--tosca-500); --bs-btn-border-color: var(--tosca-500); --bs-btn-hover-bg: var(--tosca-600); --bs-btn-hover-border-color: var(--tosca-600); --bs-btn-active-bg: var(--tosca-700); --bs-btn-active-border-color: var(--tosca-700); --bs-btn-color:#fff; --bs-btn-focus-shadow-rgb: 24,183,166; }
    .btn-outline-tosca{ --bs-btn-color: var(--tosca-700); --bs-btn-border-color: var(--tosca-500); --bs-btn-hover-bg: var(--tosca-500); --bs-btn-hover-border-color: var(--tosca-500); --bs-btn-active-bg: var(--tosca-600); --bs-btn-active-border-color: var(--tosca-600); --bs-btn-focus-shadow-rgb: 24,183,166; }

    .badge-tosca{ background: var(--tosca-500); }
    .text-tosca{ color: var(--tosca-600); }

    .table-kaca thead{ position: sticky; top: 0; z-index: 1; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); background: rgba(255,255,255,.75); border-bottom: 1px solid var(--glass-stroke); }
    .table.table-striped>tbody>tr:nth-of-type(odd){ --bs-table-accent-bg: rgba(24,183,166,.05); }
    .table.table-hover tbody tr:hover{ background: rgba(24,183,166,.09); }

    .form-control:focus, .form-select:focus{ border-color: var(--tosca-500) !important; box-shadow: 0 0 0 .25rem rgba(24,183,166,.25) !important; }
    .form-check-input{ accent-color: var(--tosca-600); }

    .card .card-header{ background: linear-gradient(180deg, rgba(24,183,166,.08), rgba(24,183,166,0) 80%); border-bottom: 1px solid rgba(24,183,166,.12); }

    @media (prefers-reduced-motion:no-preference){ .btn, .card, .navbar, .offcanvas, .list-group-item{ transition: all .25s ease; } .btn:hover{ transform: translateY(-1px);} }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-glass sticky-top">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="#">My Stay</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#navGuest">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="offcanvas offcanvas-end offcanvas-glass" id="navGuest">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title">Menu</h5>
        <button class="btn-close" data-bs-dismiss="offcanvas"></button>
      </div>
      <div class="offcanvas-body">
        <ul class="navbar-nav ms-auto gap-2">
          <li class="nav-item"><a class="nav-link" href="/guest">Dashboard</a></li>
          <li class="nav-item"><a class="nav-link" href="/guest/reservasi">Reservasi Saya</a></li>
          <li class="nav-item"><a class="nav-link" href="/guest/tagihan">Tagihan & Pembayaran</a></li>
          <li class="nav-item"><a class="nav-link" href="/guest/layanan">Pesan Layanan</a></li>
          <li class="nav-item"><a class="nav-link" href="/logout">Keluar</a></li>
        </ul>
      </div>
    </div>
  </div>
</nav>

<main class="container p-3 p-md-4">
  <!-- Greeting -->
  <div class="alert glass d-flex align-items-center" role="alert">
    <i class="bi bi-person-circle me-2 fs-4 text-tosca"></i>
    <div>
      Halo, <strong th:text="${guest.nama}">Budi Santoso</strong>! Selamat datang di <em>My Stay</em>.
    </div>
  </div>

  <div class="row g-3">
    <!-- Reservasi aktif -->
    <div class="col-12 col-lg-6">
      <div class="card glass h-100">
        <div class="card-header"><strong class="text-tosca">Reservasi Aktif</strong></div>
        <div class="card-body">
          <div th:if="${aktif != null}">
            <div class="d-flex justify-content-between">
              <div>
                <div class="fw-semibold">Kode: <span th:text="${aktif.kode}">RSV-0004</span></div>
                <div class="text-muted small">
                  Check-in: <span th:text="${#temporals.format(aktif.checkinRencana,'dd MMM yyyy')}">23 Sep 2025</span> 
                  Check-out: <span th:text="${#temporals.format(aktif.checkoutRencana,'dd MMM yyyy')}">27 Sep 2025</span>
                </div>
                <div class="mt-2">Kamar: <span class="fw-semibold" th:text="${aktif.nomorKamar}">301</span> (<span th:text="${aktif.namaTipe}">Suite</span>)</div>
                <span class="badge rounded-pill mt-2" th:classappend="${' text-bg-' + aktif.badge}" th:text="${aktif.status}">CHECK_IN</span>
              </div>
              <div class="text-end">
                <a class="btn btn-sm btn-outline-tosca" th:href="@{/guest/reservasi/{id}(id=${aktif.reservasiId})}">Detail</a>
              </div>
            </div>
          </div>
          <div th:if="${aktif == null}" class="text-muted">Anda belum punya reservasi aktif.</div>
        </div>
      </div>
    </div>

    <!-- Tagihan terbaru -->
    <div class="col-12 col-lg-6">
      <div class="card glass h-100">
        <div class="card-header"><strong class="text-tosca">Tagihan Terbaru</strong></div>
        <div class="card-body">
          <div th:if="${invoice != null}">
            <div class="d-flex justify-content-between mb-2">
              <div>
                <div class="fw-semibold">Invoice <span th:text="${invoice.kodeInvoice}">INV-0004</span></div>
                <small class="text-muted" th:text="${#temporals.format(invoice.tanggal,'dd MMM yyyy HH:mm')}">21 Sep 2025 21:58</small>
              </div>
              <div class="text-end">
                <div class="fw-bold" th:text="${#numbers.formatDecimal(invoice.total,0,'POINT',2,'COMMA')}">4.080.000</div>
                <span class="badge rounded-pill" th:classappend="${invoice.status=='LUNAS'?' text-bg-success':(invoice.status=='DRAFT'?' text-bg-secondary':' text-bg-warning')}" th:text="${invoice.status}">TERBIT</span>
              </div>
            </div>
            <a class="btn btn-tosca w-100" th:href="@{/guest/tagihan/{id}/bayar(id=${invoice.invoiceId})}">
              <i class="bi bi-credit-card"></i> Bayar Sekarang
            </a>
          </div>
          <div th:if="${invoice == null}" class="text-muted">Belum ada tagihan.</div>
        </div>
      </div>
    </div>

    <!-- Pesan layanan -->
    <div class="col-12">
      <div class="card glass">
        <div class="card-header"><strong class="text-tosca">Pesan Layanan Kamar</strong></div>
        <div class="card-body">
          <form th:action="@{/guest/layanan/pesan}" th:object="${layananForm}" method="post" class="row g-2 g-md-3">
            <div class="col-12 col-md-6">
              <label class="form-label">Jenis Layanan</label>
              <select class="form-select" name="layananId" required th:field="*{layananId}">
                <option value="" disabled selected>Pilih layanan</option>
                <option th:each="l : ${layananList}" th:value="${l.layananId}"
                        th:text="${l.nama + ' (' + #numbers.formatDecimal(l.hargaSatuan,0,'POINT',2,'COMMA') + '/' + l.satuan + ')'}">
                  Laundry (25.000/kg)
                </option>
              </select>
            </div>
            <div class="col-6 col-md-3">
              <label class="form-label">Qty</label>
              <input type="number" class="form-control" name="qty" min="1" value="1" required>
            </div>
            <div class="col-6 col-md-3 d-flex align-items-end">
              <button class="btn btn-tosca w-100" type="submit"><i class="bi bi-cart-plus"></i> Tambah</button>
            </div>
          </form>
          <div class="table-responsive mt-3">
            <table class="table table-sm table-hover table-striped align-middle table-kaca">
              <thead>
                <tr><th>Layanan</th><th>Qty</th><th>Harga</th><th>Total</th></tr>
              </thead>
              <tbody>
                <tr th:each="i : ${keranjangLayanan}">
                  <td th:text="${i.nama}">Snack Bar</td>
                  <td th:text="${i.qty}">2</td>
                  <td th:text="${#numbers.formatDecimal(i.harga,0,'POINT',2,'COMMA')}">30.000</td>
                  <td th:text="${#numbers.formatDecimal(i.qty * i.harga,0,'POINT',2,'COMMA')}">60.000</td>
                </tr>
                <tr th:if="${#lists.isEmpty(keranjangLayanan)}">
                  <td colspan="4" class="text-center text-muted">Belum ada item</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="text-end">
            <a class="btn btn-success" th:href="@{/guest/layanan/submit}"><i class="bi bi-send"></i> Kirim Pesanan</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
